<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="code-nXJP22I4Cn">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhangyijian.cn","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":"mac","style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Portswigger Web Academic çœŸçš„é¡¶ï¼">
<meta property="og:type" content="article">
<meta property="og:title" content="Portswigger ä¸å®‰å…¨çš„ååºåˆ—åŒ–">
<meta property="og:url" content="https://zhangyijian.cn/2024/02/27/Notes/Insecure%20Deserialization/index.html">
<meta property="og:site_name" content="äººç”Ÿè¾¹ä¸Š">
<meta property="og:description" content="Portswigger Web Academic çœŸçš„é¡¶ï¼">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051622176.png">
<meta property="og:image" content="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051621238.png">
<meta property="og:image" content="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051621867.png">
<meta property="article:published_time" content="2024-02-26T16:00:00.000Z">
<meta property="article:modified_time" content="2024-03-09T15:22:33.710Z">
<meta property="article:author" content="å¼ ä¸€å‰‘">
<meta property="article:tag" content="çŸ¥è¯†&#x2F;cybersecurity">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="çŸ¥è¯†&#x2F;ç¬”è®°">
<meta property="article:tag" content="è‰ç¨¿">
<meta property="article:tag" content="ååºåˆ—åŒ–">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051622176.png">

<link rel="canonical" href="https://zhangyijian.cn/2024/02/27/Notes/Insecure%20Deserialization/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Portswigger ä¸å®‰å…¨çš„ååºåˆ—åŒ– | äººç”Ÿè¾¹ä¸Š</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">äººç”Ÿè¾¹ä¸Š</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhangyijian.cn/2024/02/27/Notes/Insecure%20Deserialization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¼ ä¸€å‰‘">
      <meta itemprop="description" content="Just for fun :D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="äººç”Ÿè¾¹ä¸Š">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Portswigger ä¸å®‰å…¨çš„ååºåˆ—åŒ–
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-02-27 00:00:00" itemprop="dateCreated datePublished" datetime="2024-02-27T00:00:00+08:00">2024-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-03-09 23:22:33" itemprop="dateModified" datetime="2024-03-09T23:22:33+08:00">2024-03-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Portswigger Web Academic çœŸçš„é¡¶ï¼</p>
<span id="more"></span>
<h1 id="Insecure-deserialization"><a href="#Insecure-deserialization" class="headerlink" title="Insecure deserialization"></a>Insecure deserialization</h1><h2 id="What-is-serialization"><a href="#What-is-serialization" class="headerlink" title="What is serialization?"></a>What is serialization?</h2><blockquote>
<p><strong>Serialization</strong>Â is the process of converting complex data structures, such as objects and their fields, into a â€œflatterâ€ format that can be sent and received as a sequential stream of bytes.</p>
</blockquote>
<p>åºåˆ—åŒ–ï¼šæŠŠå¯¹è±¡è½¬æ¢æˆbytesæµï¼Œä»¥ä¾¿å‘è¿›ç¨‹å†…å­˜ã€æ–‡ä»¶æˆ–æ˜¯æ•°æ®åº“ä¸­å†™å…¥å¤æ‚æ•°æ®( complex data ï¼Œæˆ‘ç†è§£çš„æ—¢æ˜¯å›¾ä¸­çš„object)</p>
<h3 id="Serialization-vs-deserialization"><a href="#Serialization-vs-deserialization" class="headerlink" title="Serialization vs deserialization"></a>Serialization vs deserialization</h3><p>ååºåˆ—åŒ–Serializationå³æ˜¯æŠŠStream of Byteså†è½¬æ¢æˆåºåˆ—åŒ–ä¹‹å‰çš„object<br><img src="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051622176.png">ä¸åŒè¯­è¨€çš„åºåˆ—åŒ–æ–¹å¼ä¸åŒï¼Œæœ€åå¯èƒ½è½¬æ¢æˆäºŒè¿›åˆ¶æˆ–è€…å­—ç¬¦ä¸²ã€‚å¯¹è±¡çš„å±æ€§ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§ï¼‰ä¹Ÿä¼šè¢«è½¬åŒ–åˆ°Stream of Bytesã€‚å¦‚æœè¿™ä¸ªå­—æ®µä¸æƒ³è¢«åºåˆ—åŒ–ï¼Œéœ€è¦æ ‡è®°ä¸ºâ€transientâ€</p>
<h2 id="What-is-insecure-deserialization"><a href="#What-is-insecure-deserialization" class="headerlink" title="What is insecure deserialization?"></a>What is insecure deserialization?</h2><p>ç½‘ç«™ååºåˆ—åŒ–æ•°æ®æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®å¯ä»¥è¢«ç”¨æˆ·æ§åˆ¶ï¼Œattackerå°±å¯èƒ½åˆ©ç”¨è¢«åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå‘ç¨‹åºä»£ç ä¸­æ’å…¥æœ‰å®³ä¿¡æ¯ã€‚</p>
<blockquote>
<p>ä»‹ä¸è¿˜æ˜¯æ³¨å…¥å—ï¼Ÿ</p>
</blockquote>
<p>ç”šè‡³å¯èƒ½ç”¨å¦ä¸€ç±»å¯¹è±¡æ›¿ä»£ä¸€ä¸ªè¢«åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>insecure deserialization is sometimes known as an â€œobject injectionâ€ vulnerability.ç¡®å®æ˜¯æ³¨å…¥</p>
</blockquote>
<p>å¯¹è±¡çš„ç±»å’Œé¢„æœŸä¸ç¬¦å°±å¯èƒ½é€ æˆæ„æ–™ä¹‹å¤–çš„ç»“æœï¼Œç„¶åå°±é€ æˆæŸå®³äº†ã€‚è®¸å¤šåˆ©ç”¨ååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»ï¼Œåœ¨å®Œæˆååºåˆ—åŒ–è¿‡ç¨‹ä¹‹å‰ï¼Œå°±å®Œæˆäº†ã€‚å› æ­¤ï¼Œå³ä¾¿æ˜¯ç½‘ç«™è‡ªèº«åŠŸèƒ½ä¸ä¸æ¶æ„å¯¹è±¡äº¤äº’ï¼Œååºåˆ—åŒ–è¿‡ç¨‹æœ¬èº«å°±ä¼šå®Œæˆattackã€‚è¿™æ ·çš„è¯ï¼Œå³ä¾¿ç½‘ç«™logicä½¿ç”¨strongly typed languagesï¼Œä¹Ÿä¼šå—å½±å“ã€‚</p>
<h2 id="How-do-insecure-deserialization-vulnerabilities-arise"><a href="#How-do-insecure-deserialization-vulnerabilities-arise" class="headerlink" title="How do insecure deserialization vulnerabilities arise?"></a>How do insecure deserialization vulnerabilities arise?</h2><p>ååºåˆ—åŒ–æ¼æ´å‡ºç°ï¼Œä¸€èˆ¬å°±æ˜¯å› ä¸ºå¯¹ç”¨æˆ·å¯æ§æ•°æ®èƒ½é€ æˆçš„å±å®³ç¼ºä¹è®¤è¯†ã€‚</p>
<p>æœ‰æ—¶ç½‘ç«™ä½¿ç”¨é¢å¤–çš„å®‰å…¨æ£€æŸ¥ï¼Œä¹Ÿä¸ä¸€å®šæœ‰æ•ˆã€‚å› ä¸ºä¸å¯èƒ½æ¯ç§æƒ…å†µéƒ½è€ƒè™‘åˆ°ï¼Œè€Œä¸”å¾€å¾€æ˜¯åœ¨ååºåˆ—åŒ–è¿‡ç¨‹åæ£€æŸ¥ï¼Œè¿™å°±æ™šäº†ã€‚</p>
<h2 id="What-is-the-impact-of-insecure-deserialization"><a href="#What-is-the-impact-of-insecure-deserialization" class="headerlink" title="What is the impact of insecure deserialization?"></a>What is the impact of insecure deserialization?</h2><p>ä¸€èˆ¬éƒ½å¾ˆä¸¥é‡ï¼Œå› ä¸ºå¯ä»¥æå¤§åœ°æ‰©å¤§æ”»å‡»é¢ï¼Œå…è®¸æ”»å‡»è€…é‡ç”¨ç¨‹åºä»£ç ï¼Œæœ€åå¯èƒ½å°±rceäº†ã€‚å°±ç®—ä¸èƒ½rceï¼Œä¹Ÿä¼šå¯¼è‡´è¶Šæƒï¼Œä»»æ„æ–‡ä»¶è®¿é—®å’Œdosæ”»å‡»ã€‚</p>
<h1 id="Exploiting-insecure-deserialization-vulnerabilities"><a href="#Exploiting-insecure-deserialization-vulnerabilities" class="headerlink" title="Exploiting insecure deserialization vulnerabilities"></a>Exploiting insecure deserialization vulnerabilities</h1><blockquote>
<p>We hope to demonstrate how exploiting insecure deserialization is actually much easier than many people believe. This is even the case during blackbox testing if you are able to use pre-built gadget chains.ä¼¼ä¹çœ‹åˆ°äº†ç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œè¿™ä¸ªgadget chainsä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
</blockquote>
<h2 id="How-to-identify-insecure-deserialization"><a href="#How-to-identify-insecure-deserialization" class="headerlink" title="How to identify insecure deserialization"></a>How to identify insecure deserialization</h2><h3 id="PHP-serialization-format"><a href="#PHP-serialization-format" class="headerlink" title="PHP serialization format"></a>PHP serialization format</h3><p>phpå°±ç”¨mostly human-readable string formatï¼Œå­—æ¯ä»£è¡¨æ•°æ®ç±»å‹ï¼Œæ•°å­—ä»£è¡¨æ¯ä¸€é¡¹çš„é•¿åº¦ã€‚</p>
<figure class="highlight plaintext"><figcaption><span>```object with the attributes:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```php</span><br><span class="line">$user-&gt;name = &quot;carlos&quot;; </span><br><span class="line">$user-&gt;isLoggedIn = true;</span><br></pre></td></tr></table></figure>
<p>åºåˆ—åŒ–ä¹‹åï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>:s:<span class="number">6</span>:<span class="string">&quot;carlos&quot;</span>; s:<span class="number">10</span>:<span class="string">&quot;isLoggedIn&quot;</span>:b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051621238.png"><br>ç›¸åº”phpå‡½æ•°ï¼š<code>serialize()</code> <code>unserialize()</code></p>
<h3 id="Java-serialization-format"><a href="#Java-serialization-format" class="headerlink" title="Java serialization format"></a>Java serialization format</h3><p>Javaä½¿ç”¨äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼ã€‚ä½†æ˜¯å¦‚æœçŸ¥é“æ€ä¹ˆå»è¾¨åˆ«ä¸€äº›è¿¹è±¡ï¼Œè¿˜æ˜¯èƒ½åˆ†è¾¨å‡ºserialized dataçš„ã€‚</p>
<blockquote>
<p>For example, serialized Java objects always begin with the same bytes, which are encoded asÂ <code>ac ed</code>Â in hexadecimal andÂ <code>rO0</code>Â in Base64.</p>
</blockquote>
<p>å¯¹Javaæ¥è¯´ï¼Œåˆ™éœ€è¦å…³æ³¨<code>readObject()</code>ï¼Œè¿™ä¸ªå‡½æ•°è¢«ç”¨æ¥è¯»å’Œååºåˆ—åŒ–è¾“å…¥æµçš„æ•°æ®</p>
<h2 id="Manipulating-serialized-objects"><a href="#Manipulating-serialized-objects" class="headerlink" title="Manipulating serialized objects"></a>Manipulating serialized objects</h2><blockquote>
<p>Exploiting some deserialization vulnerabilities can be as easy as changing an attribute in a serialized object.</p>
</blockquote>
<p>emmm,ç¬¬ä¸€æ­¥ï¼šæ”¹å˜å±æ€§å€¼ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å»åˆ©ç”¨åºåˆ—åŒ–äº†çš„å¯¹è±¡ï¼šå…¶ä¸€ï¼Œç›´æ¥ç¼–è¾‘ byte stream ï¼›å…¶äºŒï¼Œç”¨ç›¸åº”çš„è¯­è¨€å†™ä¸ªè„šæœ¬ï¼Œè‡ªå·±åˆ›å»ºå¹¶åºåˆ—åŒ–ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ç§æ–¹æ³•åœ¨å¤„ç†äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼æ—¶æ›´æ–¹ä¾¿ã€‚</p>
<h3 id="Modifying-object-attributes"><a href="#Modifying-object-attributes" class="headerlink" title="Modifying object attributes"></a>Modifying object attributes</h3><blockquote>
<p>When tampering with the data, as long as the attacker preserves a valid serialized object, the deserialization process will create a server-side object with the modified attribute values.<br><img src="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403051621867.png"><br>?? è¿™ä¹ˆç®€å•çš„å—ï¼Ÿ</p>
</blockquote>
<p>å¹¶ä¸æ˜¯ï¼Œè¿˜éœ€è¦ä¸€ä¸ªæ¡ä»¶ï¼šâ€website uses this cookie to check whether the current user has access to certain administrative functionality.â€emmmï¼ŒçœŸçš„ä¼šæœ‰äººè¿™æ ·åšå—ï¼Ÿ</p>
<blockquote>
<p>â€œThis simple scenario is not common in the wild.â€çœ‹æ¥å¤§å®¶éƒ½æœ‰å…±è¯†XD</p>
</blockquote>
<h4 id="LAB-Modifying-serialized-objects"><a href="#LAB-Modifying-serialized-objects" class="headerlink" title="LAB: Modifying serialized objects"></a>LAB: Modifying serialized objects</h4><blockquote>
<p>æ‰¬å¸†èµ·èˆªï¼</p>
</blockquote>
<ol>
<li>åˆšå¼€å§‹çœ‹äº†å‡ ä¸ªåŒ…ï¼Œæ²¡å¤´ç»ªï¼Œçœ‹ä¸åˆ°ä»»ä½•byte streamã€‚</li>
<li>çœ‹äº†è¿”å›çš„åŒ…åï¼Œæƒ³èµ·cookieäº†ï¼Œå‘ç°å¾ˆåƒbase64ï¼Œä¼ å»decoderï¼Œä¸€åˆ‡å°±é¡ºç†æˆç« èµ·æ¥</li>
<li>emmm ï¼Œæ”¹é”™äº†ï¼Œå¼±æ™ºäº†ï¼Œå¾—åœ¨requesté‡Œæ”¹ï¼Œæ•´æˆåœ¨responseé‡Œæ”¹äº†</li>
<li>æˆåŠŸå‡ºç°admin panel</li>
<li>ä½†æ˜¯å¹¶æ²¡æœ‰å®Œï¼Œä¿®æ”¹äº†requeståŒ…ä¸­çš„å­—æ®µï¼Œæµè§ˆå™¨å‘çš„cookieè¿˜æ˜¯åŸæ¥çš„ï¼Œè¿˜å¾—æ”¹æµè§ˆå™¨ä¸­çš„cookie</li>
<li>F12 åœ¨applicationæ ä¸­ä¿®æ”¹cookieå³å¯</li>
</ol>
<h3 id="Modifying-data-types"><a href="#Modifying-data-types" class="headerlink" title="Modifying data types"></a>Modifying data types</h3><p>ä¸ä»…å¯ä»¥ä¿®æ”¹objectçš„å±æ€§å€¼ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨é¢„æœŸä¹‹å¤–çš„æ•°æ®ç±»å‹ã€‚</p>
<p>è¿™é‡Œæåˆ°ï¼ŒPHP-based logic å°¤å…¶æ˜“å—å½±å“ã€‚å› ä¸ºphpçš„æ¯”è¾ƒè¿ç®—ç¬¦<code>==</code>åœ¨æ¯”è¾ƒä¸åŒæ•°æ®ç±»å‹æ—¶åˆ¤å®šå¾—å¾ˆå®½æ¾ã€‚emmmï¼Œæˆ‘å¥½åƒåœ¨é‚£ä¸ªmemeä¸Šçœ‹åˆ°è¿‡ï¼Œæœ‰ç‚¹å°è±¡ï¼Œæ˜¯JavaScriptè¿˜æ˜¯PHPæ¥ç€ï¼Ÿ</p>
<p>ä»¥æ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²ä¹Ÿé€‚ç”¨äº<code>5 == &quot;5&quot;</code>è¿™ä¸€ç‚¹ï¼ŒPHPä¼šæŠŠæ•´ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆå¼€å¤´å¾—æ•°å­—ï¼ŒåŒæ—¶å¿½ç•¥å…¶ä»–éƒ¨åˆ†ã€‚<code>5 == &quot;5 of something&quot;</code></p>
<blockquote>
<p>This becomes even stranger when comparing a string the integer <code>0</code>:</p>
<p><code>0 == &quot;Example string&quot; // true // wtf?</code></p>
</blockquote>
<blockquote>
<p>â€œÂ Because there is no number, that is, 0 numerals in the string. PHP treats this entire string as the integerÂ <code>0</code>.â€</p>
<p>emmm,å¾ˆéš¾è¯„ä»·</p>
</blockquote>
<p>å› æ­¤åœ¨é¢å¯¹å¦‚ä¸‹ä»£ç æ—¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>) </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$login</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="variable">$password</span>) &#123; </span><br><span class="line"><span class="comment">// log in successfully </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨è¿™ä¸€æ€§è´¨â€enabling an authentication bypass.â€œä½†ä¹Ÿæ˜¯æœ‰æ¡ä»¶çš„ï¼š</p>
<blockquote>
<p>Note that this is only possible because deserialization preserves the data type. If the code fetched the password from the request directly, theÂ <code>0</code>Â would be converted to a string and the condition would evaluate toÂ <code>false</code>.</p>
</blockquote>
<p>è€Œä¸”è¦è®°å¾—æ›´æ–°type labels å’Œ length indicatorsï¼š</p>
<blockquote>
<p>Be aware that when modifying data types in any serialized object format, it is important to remember to update any type labels and length indicators in the serialized data too. Otherwise, the serialized object will be corrupted and will not be deserialized.</p>
</blockquote>
<p>è¿™é‡Œå®ƒè¿˜æ¨èäº†ä¸€ä¸ªæ‰©å±•ï¼šHackvertor ï¼Œ åœ¨å¤„ç†äºŒè¿›åˆ¶æ•°æ®æ—¶ï¼Œå¯ä»¥æŠŠåºåˆ—åŒ–çš„æ•°æ®æ ¼å¼åŒ–æˆå­—ç¬¦ä¸²ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°äºŒè¿›åˆ¶æ•°æ®ï¼Œè°ƒæ•´åç§»é‡ã€‚</p>
<h4 id="LAB-Modifying-serialized-data-types"><a href="#LAB-Modifying-serialized-data-types" class="headerlink" title="LAB : Modifying serialized data types"></a>LAB : Modifying serialized data types</h4><ol>
<li>é¢˜ç›®æè¿°ä¸­ï¼Œâ€is vulnerable to authentication bypass as a result. â€œï¼Œè¾¾åˆ°â€edit the serialized object in the session cookie to access theÂ <code>administrator</code>Â account. Then, delete the userÂ <code>carlos</code>.â€œå³å¯</li>
<li>æœ‰äº†ä¸Šæ¬¡çš„ç»éªŒï¼ŒæŸ¥çœ‹cookieï¼Œbase64è§£ç åä¸º<code>O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;wiener&quot;;s:12:&quot;access_token&quot;;s:32:&quot;kkbu4w4wcyqhanxqvlp42eocv9o5hxui&quot;;&#125;</code><blockquote>
<p>by the way ,è¿™hackvertorä¸å’‹ä¼šç”¨å•Šï¼Œå®ƒGitHubä¸Šå†™çš„ä¸æ˜¯å¾ˆç®€å•å—ï¼Ÿ</p>
</blockquote>
</li>
<li>æŠŠaccess_token ç›¸åº”lengthæ”¹ä¸º1ï¼Œå€¼æ”¹ä¸º0ã€‚emmmï¼Œéœ€ä¸éœ€è¦æ”¹ç±»å‹å‘¢ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“phpé‡Œintegerç¼©å†™æˆå•¥å•Šï¼Ÿ</li>
<li>æŠ¥é”™<code>PHP Fatal error: Uncaught Exception: unserialize() failed in /var/www/index.php:4 Stack trace: #0 &#123;main&#125; thrown in /var/www/index.php on line 4</code></li>
<li><a target="_blank" rel="noopener" href="https://www.programming-books.io/essential/php/serialization-of-different-types-3b8a66c6eaab4931b5dc0386b88bdcc2">åºåˆ—åŒ–ä¸åŒç±»å‹</a><blockquote>
<p>åŸæ¥ä¸æ˜¯hackvertorçš„é—®é¢˜ï¼Œæˆ‘çš„é—®é¢˜ï¼Œsessionä¸­å€¼éœ€è¦å…ˆ<code>d_url</code> then <code>d_base64</code></p>
</blockquote>
</li>
<li>ç›¸åº”å­—æ®µæ”¹ä¸º<code>i:0</code>ï¼Œå†ç”Ÿæˆæ–°çš„cookieå³å¯</li>
</ol>
<h2 id="Using-application-functionality"><a href="#Using-application-functionality" class="headerlink" title="Using application functionality"></a>Using application functionality</h2><p>é™¤äº†è ¢è ¢åœ°æ£€æŸ¥å±æ€§å€¼å¤–ï¼Œwebsiteçš„åŠŸèƒ½å¯èƒ½åœ¨ååºåˆ—åŒ–äº†çš„objectä¸Šæ‰§è¡Œå±é™©æ“ä½œã€‚</p>
<p>ä¸¾ä¾‹ï¼šâ€œDelete userâ€åŠŸèƒ½ï¼Œåˆ é™¤ç”¨æˆ·çš„å¤´åƒæ–‡ä»¶æ˜¯é€šè¿‡â€œaccessing the file path in theÂ <code>$user-&gt;image_location</code>Â attribute.â€å®ç°çš„ã€‚å¦‚æœä¼ ä¸ªä¿®æ”¹è¿‡<code>image_location</code>å€¼çš„objectï¼Œå°±å¯ä»¥åˆ é™¤ä»»æ„æ–‡ä»¶äº†ã€‚</p>
<p>â€Labæ˜¯æ‰‹å·¥åšçš„ï¼Œä½†å¦‚æœè‡ªåŠ¨åœ°Â pass data into dangerous methods æ¥åˆ©ç”¨æ¼æ´ï¼Œæƒ…å†µä¼šå¾ˆæœ‰è¶£â€œç„¶åå¼•å‡ºäº†ä¸‹ä¸€èŠ‚ï¼ŒMagic methods</p>
<h4 id="LAB-Using-application-functionality-to-exploit-insecure-deserialization"><a href="#LAB-Using-application-functionality-to-exploit-insecure-deserialization" class="headerlink" title="LAB: Using application functionality to exploit insecure deserialization"></a>LAB: Using application functionality to exploit insecure deserialization</h4><ol>
<li>â€˜A certain feature invokes a dangerous method on data provided in a serialized object.â€™ï¼Œè€Œä¸”è¿™é‡ŒæŒ‡æ˜äº†â€™the serialized object in the session cookieâ€™ </li>
<li>è¿˜ç»™äº†ä¸ªå¤‡ç”¨è´¦æˆ·ï¼Œä¸çŸ¥é“å¹²å˜›çš„</li>
<li>å‡ºç°äº†ä¸ªdelete accountï¼Œå…ˆç”¨åˆ«çš„è¯•è¯•ï¼Œæœ‰ç‚¹æ˜ç™½è¿™ä¸ªbackup accountæ˜¯å¹²å˜›çš„äº†<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O<span class="punctuation">:</span><span class="number">4</span><span class="punctuation">:</span><span class="attr">&quot;User&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>s<span class="punctuation">:</span><span class="number">8</span><span class="punctuation">:</span><span class="string">&quot;username&quot;</span>;s<span class="punctuation">:</span><span class="number">6</span><span class="punctuation">:</span><span class="string">&quot;wiener&quot;</span>;s<span class="punctuation">:</span><span class="number">12</span><span class="punctuation">:</span><span class="string">&quot;access_token&quot;</span>;s<span class="punctuation">:</span><span class="number">32</span><span class="punctuation">:</span><span class="string">&quot;omu50cbc6k2m7c638uy9j9u15zmv9oa2&quot;</span>;s<span class="punctuation">:</span><span class="number">11</span><span class="punctuation">:</span><span class="string">&quot;avatar_link&quot;</span>;s<span class="punctuation">:</span><span class="number">19</span><span class="punctuation">:</span><span class="string">&quot;users/wiener/avatar&quot;</span>;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>emmmï¼Œæˆ‘çŒœavatar_link å³æŒ‡æ˜äº†å¤´åƒçš„åœ°å€ï¼Œæ”¹è¿™ä¸ªã€‚ä½†æ˜¯ï¼Œemmmï¼Œä¸å¤§ç¡®å®šè¿™ä¸ªç›®å½•ç»“æ„æ€ä¹ˆå›äº‹ï¼Œæ”¾åœ¨äº†usersä¸‹é¢å—ã€‚emmmï¼Œå¯¹å“¦ã€‚è¿™æ˜¯ä¸ªweb applicationï¼Œç¡®å®ï¼Œæƒ³é”™äº†å§å¯èƒ½æˆ‘ã€‚</li>
<li>ä»¥é˜²ä¸‡ä¸€ï¼Œä¼ ä¸ªå¤´åƒä¸Šå»çœ‹ä¸‹location</li>
<li>emmmï¼Œå¼„å·§æˆæ‹™äº†ï¼Œä¼ çš„lennaå›¾ï¼Œç»“æœå¤ªå¤§äº†ï¼Œè‡ªå·±æ‰“ä¸å¼€äº†ã€‚</li>
<li>æ‰€ä»¥æˆ‘çŒœæµ‹ç›®å½•ç»“æ„æ˜¯<code>/home/Carlos/morale.txt</code>,23ä¸ªå­—ç¬¦</li>
<li>å¤±è´¥åŠ›ï¼æ˜ç™½å¤‡ç”¨è´¦æˆ·å¹²å˜›çš„äº†</li>
<li>ä¹Ÿè®¸æˆ‘æƒ³é”™ç›®å½•äº†ï¼Ÿ</li>
<li><code>/users/Carlos/morale.txt</code>, 24ä¸ªå­—ç¬¦</li>
<li>å¥½çš„ï¼Œä¿©è´¦æˆ·åˆ å®Œäº†ï¼Œæ²¡è§£å†³ï¼Œå¤ªæ£’äº†</li>
<li>å®Œäº†ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªå’‹é‡ç½®ï¼Œå¤ªæ£’äº†</li>
<li>ç­‰15åˆ†é’Ÿ</li>
<li>çœ‹äº†çœ¼solutionï¼Œ<code>/home/Carlos/morale.txt</code>è¿™ä¸ªåœ°å€çŒœçš„æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å…¨æ˜¯å°å†™ï¼Œusernameå†™é”™äº†ï¼Œæ‚²ä¼¤ï¼Œé€†æµæˆæ²³ã€‚</li>
</ol>
<h2 id="Magic-methods"><a href="#Magic-methods" class="headerlink" title="Magic methods"></a>Magic methods</h2><p>â€œInstead, they are invoked automatically whenever a particular event or scenario occurs.â€æˆ‘ä¸æ˜ç™½ï¼Ÿä¸Šä¸€ä¸ªæ˜¯åœ¨åˆ é™¤ç”¨æˆ·æ—¶invokeçš„ï¼Œè¿™ä¸ªéš¾é“ä»€ä¹ˆéƒ½ä¸éœ€è¦åšï¼Ÿ</p>
<p>â€œÂ They are sometimes indicated by prefixing or surrounding the method name with double-underscores.â€ </p>
<blockquote>
<p>Developers can add magic methods to a class in order to predetermine what code should be executed when the corresponding event or scenario occurs.</p>
</blockquote>
<p>å°±åƒåˆ›å»ºå¯¹è±¡æ—¶ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°é‚£æ ·å—ï¼Ÿâ€One of the most common examples in PHP isÂ <code>__construct()</code>, which is invoked whenever an object of the class is instantiated, similar to Pythonâ€™sÂ <code>__init__</code>.â€œğŸ˜•ï¼Œæˆ‘æƒ³æˆ‘æ¥è¿‘äº†æ­£ç¡®ç­”æ¡ˆã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹Magic methodsæœ¬èº«æ²¡æœ‰æ¼æ´ã€‚â€But they can become dangerous when the code that they execute handles attacker-controllable dataâ€œ ä»–ä¸¾ä¾‹è¯´ï¼Œæ”»å‡»è€…å¦‚æœæ„é€ çš„ååºåˆ—åŒ–å¯¹è±¡ç¬¦åˆç›¸åº”æ¡ä»¶æ—¶ï¼Œå°±å¯ä»¥â€automatically invoke methodsâ€œ</p>
<p>â€some languages have magic methods that are invoked automaticallyÂ <strong>during</strong>Â the deserialization process.â€œ ä¸¾ä¾‹ï¼šPHPâ€™s unserialize() method looks for and invokes an objectâ€™s __wakeup() magic method.è¿˜æœ‰Javaçš„<code>ObjectInputStream.readObject()</code>Javaçš„<code>Serializable</code>ä¹Ÿæ˜¯å¯ä»¥å£°æ˜è‡ªå·±çš„<code>readObject()</code>è¿™ä¸ª<code>readObject()</code>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¹Ÿå°±ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>æˆ‘æœ‰ç‚¹æ˜ç™½ï¼Œä¸ºä»€ä¹ˆä¸Šæ–‡ä¸­ä¸¾å‡ºé¢å¤–çš„å®‰å…¨æ£€æŸ¥ä¹Ÿä¸ä¸€å®šæœ‰æ•ˆäº†ã€‚</p>
<p>â€Â They allow you to pass data from a serialized object into the websiteâ€™s code before the object is fully deserialized. This is the starting point for creating more advanced exploits.â€œğŸ˜•(by the way , æˆ‘æ˜¯çœŸå–œæ¬¢æ’‡å˜´è¿™ä¸ªè¡¨æƒ…) </p>
<h2 id="Injecting-arbitrary-objects"><a href="#Injecting-arbitrary-objects" class="headerlink" title="Injecting arbitrary objects"></a>Injecting arbitrary objects</h2><p>â€œÂ injecting arbitrary object types can open up many more possibilities.â€æ”»å‡»è€…é€šè¿‡æ§åˆ¶åºåˆ—åŒ–æ•°æ®ä¸­objectçš„ç±»ï¼Œæ¥å½±å“ååºåˆ—åŒ–åï¼Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ ï¼Œ æ‰€æ‰§è¡Œçš„ä»£ç ã€‚</p>
<p>â€Deserialization methods do not typically check what they are deserializing.â€œæ‰€ä»¥åªè¦æ˜¯websiteèƒ½ç”¨çš„ï¼Œå¯ä»¥ä¼ ï¼Œç„¶åè¢«ååºåˆ—åŒ–ã€‚æ”»å‡»è€…å°±å¯ä»¥æ®æ­¤ï¼Œåˆ›å»ºä»»æ„ç±»çš„å®ä¾‹ã€‚â€The unexpected object type might cause an exception in the application logic, but the malicious object will already be instantiated by then.â€œä¸æ˜ç™½ï¼ŒğŸ¤”ï¼Œæˆ‘æƒ³å¯èƒ½æ˜¯è¯´å®ä¾‹åŒ–æ¶æ„ä»£ç ï¼Œå°½ç®¡ä¼ ä¸ªåˆ«çš„ç±»å¯¹è±¡å¯èƒ½ä¼šå¼•èµ·website logic æ„æ–™ä¹‹å¤–çš„ç»“æœï¼Œä½†æ¶æ„ä»£ç æ€»å½’æ˜¯ä¼ ä¸Šå»äº†ï¼ˆï¼Ÿï¼‰ã€‚</p>
<p>â€The attacker can then pass in a serialized object of this class to use its magic method for an exploit.â€œç»“åˆä¸Šä¸€èŠ‚ï¼Œæ„é€ æ‰€é€‰å–çš„classè¿˜æ˜¯æœ‰æ‰€å–å‘çš„ï¼Œå½“ç„¶è¿™æ˜¯â€has access to the source codeâ€œçš„æƒ…å†µã€‚</p>
<p>â€Classes containing these deserialization magic methods can also be used to initiate more complex attacks involving a long series of method invocations, known as a â€œgadget chainâ€.â€œè¦æ¥åŠ›ğŸ™Œ</p>
<h4 id="Lab-Arbitrary-object-injection-in-PHP"><a href="#Lab-Arbitrary-object-injection-in-PHP" class="headerlink" title="Lab: Arbitrary object injection in PHP"></a>Lab: Arbitrary object injection in PHP</h4><p>è¿™é‡Œæœ‰ä¸ªhintæˆ‘è§‰å¾—å¾ˆæœ‰å¸®åŠ©ï¼Œæˆ‘è®°å¾—ä¸æ˜¯23å¹´æ¹¾æ¹¾é‚£è¾¹æŠ¥äº†å“ªä¸ªç¼–è¾‘å™¨çš„æ´å°±æ˜¯è¿™ä¸ªï¼š</p>
<p>You can sometimes read source code by appending a tilde (<code>~)</code>Â to a filename to retrieve an editor-generated backup file.</p>
<p>è™½ç„¶ä½†æ˜¯ï¼Œæˆ‘æ€ä¹ˆè¯¥å®¡è®¡å“ªä¸ªæ–‡ä»¶å•Šï¼Ÿæˆ‘ä¸€æ— æ‰€çŸ¥å•ŠğŸ˜£</p>
<ol>
<li>çœ‹æ¥åªæœ‰change mail ä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨äº†POSTå¤´ï¼Œç›´æ¥è®¿é—®<code>/my-account/change-email~</code>å¹¶ä¸è¡Œ,emmm,åº”è¯¥æ˜¯phpæ–‡ä»¶å§ï¼Ÿä½†æ˜¯ç›´æ¥è®¿é—®<code>/my-account/change-email</code>æ—¶æ˜¾ç¤º<code>&quot;Method Not Allowed&quot;</code></li>
<li>å®ƒè¿™ä¸ªç›®å½•ç»“æ„åˆ°åº•æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</li>
<li>çœ‹äº†çœ¼solutionï¼Œâ€From the site map, notice that the website references the fileÂ <code>/libs/CustomTemplate.php</code>â€œ </li>
<li>çœ‹äº†ä¸ªè§†é¢‘ï¼Œå‘ç°æ˜¯é€šè¿‡burp suiteçš„Target æ ï¼ŒSite map å‘ç°çš„ï¼Œä»¥å‰éƒ½ä¸çŸ¥é“æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚ä½†æ˜¯å®ƒè¿™ä¸ªæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä¸€ä¸ªæ‰«æå™¨ï¼Ÿ</li>
<li>å¥½åœ¨ä»£ç ä¸é•¿è¿˜ç»™æç¤º<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTemplate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$template_file_path</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lock_file_path</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$template_file_path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;template_file_path = <span class="variable">$template_file_path</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lock_file_path = <span class="variable">$template_file_path</span> . <span class="string">&quot;.lock&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">isTemplateLocked</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;lock_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTemplate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;template_file_path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">saveTemplate</span>(<span class="params"><span class="variable">$template</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">isTemplateLocked</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;lock_file_path, <span class="string">&quot;&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Could not write to &quot;</span> . <span class="variable language_">$this</span>-&gt;lock_file_path);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;template_file_path, <span class="variable">$template</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Could not write to &quot;</span> . <span class="variable language_">$this</span>-&gt;template_file_path);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Carlos thought this would be a good idea</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;lock_file_path)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;lock_file_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>emmmï¼Œæƒ³å½“ç„¶ã€‚æ„é€ lock_file_pathå±æ€§ã€‚æœ‰ä¸€è¯´ä¸€ï¼Œè¿™ä¸ª<code>unlink()</code>æ˜¯å¹²å˜›çš„ï¼Ÿphpçš„å‡½æ•°ï¼Œç”¨æ¥åˆ é™¤æ–‡ä»¶ã€‚ç¬¦åˆéœ€æ±‚ã€‚</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡Hackvertorè®¡ç®—string length<code>&lt;@length&gt;/home/carlos/morale.txt&lt;@/length&gt;</code></li>
<li><code>O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;wiener&quot;;s:12:&quot;access_token&quot;;s:32:&quot;h8ogciry8yqy8fizpuckdy2ckw32hg3l&quot;;s:14:&quot;lock_file_path&quot;;s:23:&quot;/home/carlos/morale.txt&quot;;&#125;</code>ä¸è¦å¿˜è®°åŠ æœ€åçš„<code>;</code>ï¼ä¹Ÿä¸è¦å¿˜è®°æŒ‡å‡ºå±æ€§å<code>lock_file_path</code></li>
<li>emmm,æ•´é”™äº†ï¼Ÿåº”è¯¥æ„å»º<code>template_file_path</code>ä½†æ˜¯phpæ˜¯ä¸æ˜¯ä¼šç»™å®ƒåŠ ä¸Š<code>.lock</code>ï¼Ÿéœ€è¦æˆªæ–­ï¼Ÿ</li>
<li>hhhhï¼Œåšæ˜å¤´äº†ã€‚å¿˜äº†è¿™èŠ‚æ˜¯å¹²å˜›çš„äº†ï¼Ÿè¦æ„å»º<code>CustomTemplate</code>ç±»çš„objectï¼</li>
<li>æ€»å½’è¿˜æ˜¯å› ä¸ºä¸æ‡‚phpï¼Œä¸æ‡‚å‰ç«¯ã€‚</li>
<li><code>O:14:&quot;CustomTemplate&quot;:1:&#123;s:14:&quot;lock_file_path&quot;;s:23:&quot;/home/carlos/morale.txt&quot;;&#125;</code>å…¶ä¸­<code>O:14:</code>æ˜¯å› ä¸ºç±»åCustomTemplateé•¿åº¦ä¸º14ï¼Œåè¾¹çš„å‚æ•°1æ˜¯å› ä¸ºåªæœ‰ä¸€é¡¹å±æ€§</li>
</ol>
<h2 id="Gadget-chains"><a href="#Gadget-chains" class="headerlink" title="Gadget chains"></a>Gadget chains</h2><blockquote>
<p>A â€œgadgetâ€ is a snippet of code that exists in the application that can help an attacker to achieve a particular goal.</p>
</blockquote>
<p> æˆ‘åŸæœ¬è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆå·¥å…·ï¼Œæ²¡æƒ³åˆ°æ˜¯applicationé‡Œè‡ªå¸¦çš„ã€‚</p>
<blockquote>
<p>However, the attackerâ€™s goal might simply be to invoke a method that will pass their input into another gadget.</p>
</blockquote>
<p> æ‰€ä»¥æ˜¯â€œGadget chainsâ€æ˜¯å§ï¼Ÿ</p>
<blockquote>
<p>By chaining multiple gadgets together in this way, an attacker can potentially pass their input into a dangerous â€œsink gadgetâ€, where it can cause maximum damage.</p>
</blockquote>
<p> ä½†æ˜¯è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿè¿™é‡Œå®ƒè¿˜æé†’ï¼šgadget chain ä¸æ˜¯æ”»å‡»è€…ä¼ è¿‡æ¥çš„payloadï¼Œå®ƒä»¬æœ¬èº«å°±åœ¨websiteé‡Œçš„ã€‚æ”»å‡»è€…åªæ˜¯æ§åˆ¶ä¼ ç»™gadget chainçš„æ•°æ®ã€‚é€šå¸¸ï¼Œä½¿ç”¨ååºåˆ—åŒ–è¿‡ç¨‹å½“ä¸­çš„magic methodå®ç°ï¼Œæœ‰æ—¶è¢«å«åšâ€œkick-of gadgetâ€ã€‚</p>
<blockquote>
<p>In the wild, many insecure deserialization vulnerabilities will only be exploitable through the use of gadget chains.</p>
</blockquote>
<p>å¯èƒ½åªéœ€è¦ä¸€ä¸¤æ­¥chianï¼Œä½†æ˜¯æƒ³å®ç°æ›´ä¸¥é‡çš„æ”»å‡»å°±å¯èƒ½å¾—è¦â€œa more elaborate sequence of object instantiations and method invocations.â€</p>
<p>åœ¨åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´æ—¶ï¼Œæ„å»ºgadget chainsæ˜¯å…³é”®æŠ€èƒ½ä¹‹ä¸€ã€‚</p>
<h3 id="Working-with-pre-built-gadget-chains"><a href="#Working-with-pre-built-gadget-chains" class="headerlink" title="Working with pre-built gadget chains"></a>Working with pre-built gadget chains</h3><p>äººå·¥åœ°å»è¾¨è®¤gadget chainsä¼šéå¸¸å›°éš¾ï¼Œæ²¡æºç æ—¶æ›´æ˜¯å‡ ä¹ä¸å¯èƒ½ã€‚</p>
<p>è¿™é‡Œæåˆ°â€œpre-built gadget chainsâ€ã€‚æœ‰å¾ˆå¤šå·¥å…· ï¼Œå¯ä»¥æä¾›ä¸€ç³»åˆ—åœ¨å…¶å®ƒç½‘ç«™ä¸ŠæˆåŠŸåˆ©ç”¨ï¼Œå·²ç»è¢«å‘ç°çš„chainsã€‚å°±ç®—å¾—ä¸åˆ°æºç ï¼Œä¹Ÿèƒ½ç”¨è¿™äº›å·¥å…·å¾ˆæ–¹ä¾¿åœ°å»è¾¨åˆ«ï¼Œåˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ã€‚</p>
<blockquote>
<p>This approach is made possible due to the widespread use of libraries that contain exploitable gadget chains.</p>
</blockquote>
<p>è¿™è®©æˆ‘æƒ³èµ·äº†log4j2å’Œwebpçš„æ´ï¼ˆä¹Ÿè®¸åè€…æ›´ä¸ºæ°å½“ï¼‰ã€‚</p>
<blockquote>
<p>For example, if a gadget chain in Javaâ€™s Apache Commons Collections library can be exploited â€¦â€¦ balabala </p>
</blockquote>
<p>emmmï¼Œlibå®‰å…¨å¾ˆé‡è¦ã€‚ğŸ¤”è¿™ç®—ä¸ç®—ä¾›åº”é“¾å®‰å…¨ï¼Ÿç®—<a target="_blank" rel="noopener" href="https://www.redhat.com/zh/topics/security/what-is-software-supply-chain-security">ä»€ä¹ˆæ˜¯è½¯ä»¶ä¾›åº”é“¾å®‰å…¨é˜²æŠ¤ï¼Ÿ</a></p>
<h4 id="ysoserial"><a href="#ysoserial" class="headerlink" title="ysoserial"></a>ysoserial</h4><p>ç»™å‡ºäº†ä¸€ä¸ªå·¥å…·ã€‚é€‰ä¸ªç›®æ ‡webç”¨çš„libï¼Œå°±å¯ä»¥ä¼ å…¥ä½ æƒ³æ‰§è¡Œçš„ä»£ç ã€‚â€but it is considerably less labor-intensive than constructing your own gadget chains manually.â€œå’±ä¹Ÿä¸çŸ¥é“å’‹æ„å»ºã€‚</p>
<blockquote>
<h4 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h4><p> In Java versions 16 and above, you need to set a series of command-line arguments for Java to run ysoserial. ç„¶åç»™å‡ºäº†ä¸€äº›å‘½ä»¤ã€‚æˆ‘ä¸ç¡®å®šè¿™ç¯‡æ–‡ç« æ˜¯å¦è¶³å¤Ÿæ–°ï¼Œä¸æ”¾äº†ã€‚</p>
</blockquote>
<blockquote>
<p>you can use the following ones to help you quickly detect insecure deserialization on virtually any server:</p>
</blockquote>
<ul>
<li>TheÂ <code>URLDNS</code>Â chain triggers a DNS lookup for a supplied URL.åŒæ—¶ç”±äºå®ƒä¸ä¾èµ–äºç›®æ ‡åº”ç”¨æ‰€ç”¨çš„libraryï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ä»»ä½•Javaç‰ˆæœ¬ä¸Šã€‚ç”¨æ¥detectionæ˜¯æœ€æ™®é€‚çš„ã€‚</li>
<li><code>JRMPClient</code>Â is another universal chain that you can use for initial detection.é€šè¿‡å»ºç«‹TCPè¿æ¥ã€‚</li>
<li><ol>
<li>Note that you need to provide a raw IP address rather than a hostname.</li>
</ol>
</li>
<li><ol start="2">
<li>Â This chain may be useful in environments where all outbound traffic is firewalled, including DNS lookups.</li>
</ol>
</li>
<li>You can try generating payloads with two different IP addresses: a local one and a firewalled, external one. If the application responds immediately for a payload with a local address, but hangs for a payload with an external address, causing a delay in the response, this indicates that the gadget chain worked because the server tried to connect to the firewalled address. In this case, the subtle time difference in responses can help you to detect whether deserialization occurs on the server, even in blind cases.ä»‹ç©æ³•ä¹Ÿå¤ªtmé«˜é˜¶äº†ã€‚</li>
</ul>
<h4 id="Lab-Exploiting-Java-deserialization-with-Apache-Commons"><a href="#Lab-Exploiting-Java-deserialization-with-Apache-Commons" class="headerlink" title="Lab: Exploiting JavaÂ deserializationÂ with Apache Commons"></a>Lab: Exploiting JavaÂ deserializationÂ with Apache Commons</h4><p>Â â€loads the Apache Commons Collections library.â€œâ€you can still exploit this lab using pre-built gadget chainsâ€œ<br>Â 1. æ²¡ä»€ä¹ˆå¤´ç»ªï¼Œå·¥å…·çœ‹æ¥éœ€è¦æŒ‡å®špayloadï¼Œæˆ‘å†³å®šå…ˆç”¨<code>urldns</code>è¯•ä¸‹<br>Â 2. è¿™é‡Œæ¯«æ— å¤´ç»ªç›´æ¥çœ‹äº†solution<br>Â 3. é¢˜è§£ï¼š<br>Â 4. å…ˆç™»é™†è´¦æˆ·ï¼Œç„¶åæŠŠä¸ªrequeståŒ…é€å»repeater<br>Â 5. In Java versions 16 and above: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-all.jar \ </span><br><span class="line">--add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \ --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \ --add-opens=java.base/java.net=ALL-UNNAMED \ --add-opens=java.base/java.util=ALL-UNNAMED \ CommonsCollections4 <span class="string">&#x27;rm /home/carlos/morale.txt&#x27;</span> | <span class="built_in">base64</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>è¿™é‡Œä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¸ºä»€ä¹ˆpayloadé€‰ç”¨<code>CommonsCollections4</code>ä¹Ÿæ²¡æœ‰å“ªä¸ªæ•™ç¨‹æŒ‡å‡º<blockquote>
<p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E5%85%B7ysoserial%E5%88%86%E6%9E%90.html">https://wooyun.js.org/drops/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E5%85%B7ysoserial%E5%88%86%E6%9E%90.html</a> å¾ˆé—æ†¾ï¼Œè¿™æ˜¯ç¯‡wooyunä¸Šçš„æ–‡ç« çš„archiveï¼Œåªèƒ½è¯´ysoserialçœŸçš„æ˜¯å¾ˆè€äº†ã€‚</p>
</blockquote>
</li>
<li>è€Œä¸”è¿™ä¸ªgadget chainså¾ˆè€ï¼Œä¹Ÿæ²¡æœ‰æ›´æ–°ï¼Œåªèƒ½åœ¨Java15ä¹‹ä¸‹çš„ç‰ˆæœ¬è¿è¡Œã€‚æˆ‘æš‚ä¸”ä½¿ç”¨<code>archlinux-java set java-11-openjdk</code>æ¥æ”¹å˜Javaç‰ˆæœ¬</li>
<li>è€Œä¸”è¦å°†base64ç¼–ç è½¬ä¸ºURLç¼–ç </li>
<li>ğŸ˜”åšå¾—äº‘é‡Œé›¾é‡Œ</li>
</ol>
<h4 id="PHP-Generic-Gadget-Chains"><a href="#PHP-Generic-Gadget-Chains" class="headerlink" title="PHP Generic Gadget Chains"></a>PHP Generic Gadget Chains</h4><p>æåˆ°äº†proof-of-concept tools ï¼š â€œPHP Generic Gadget Chainsâ€ (PHPGGC).</p>
<p>å®ƒåˆå¼ºè°ƒäº†ä¸€éè¯´ï¼Œæ¼æ´è¿˜æ˜¯å› ä¸ºç”¨æˆ·å¯æ§æ•°æ®çš„ååºåˆ—åŒ–å¯¼è‡´çš„ï¼Œä¸è¦æ€ªç½ªåˆ°gadget chainsæˆ–è€…libså¤´ä¸Šã€‚å°±ç®—æŠŠæ‰€æœ‰çš„gadget chainéƒ½å µä¸Šï¼Œä¸æ§åˆ¶è¿™äº›ä¸å¯ä¿¡æ•°æ®çš„ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æ— æµäºäº‹ã€‚</p>
<h4 id="Lab-Exploiting-PHP-deserialization-with-a-pre-built-gadget-chain"><a href="#Lab-Exploiting-PHP-deserialization-with-a-pre-built-gadget-chain" class="headerlink" title="Lab: Exploiting PHP deserialization with a pre-built gadget chain"></a>Lab: Exploiting PHP deserialization with a pre-built gadget chain</h4><ol>
<li>phpggcè¦æ±‚phpç‰ˆæœ¬å¤§äºç­‰äº5.6 ï¼Œcloneä¸‹æ¥è·‘å°±å¯ä»¥äº†</li>
<li>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œhow to identify the target framework?</li>
<li>ok,çœ‹responseæ—¶å‘ç°æœ‰ä¸€è¡Œæ˜¯æ³¨é‡Šè¿‡çš„ï¼ŒæˆåŠŸåœ¨<code>/cgi-bin/phpinfo.php</code>å¼¹å‡ºphpä¿¡æ¯ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ‰¾äº†ã€‚</li>
<li>ç¿»æ¥è¦†å»ä¸æ˜ç™½ï¼Œçœ‹äº†çœ¼é¢˜è§£ï¼Œæ˜ç™½äº†ï¼Œè¶…å‡ºæˆ‘çš„çŸ¥è¯†å‚¨å¤‡äº†å·²ç»ã€‚åºåˆ—åŒ–çš„æ•°æ®ä¸­è¿˜éœ€è¦ä½¿ç”¨SHA-1ç­¾åã€‚</li>
</ol>
<p>å› æ­¤ï¼Œæˆ‘çš„labå’Œexploitingä¹‹æ—…å°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚</p>
<h2 id="How-to-prevent-insecure-deserialization-vulnerabilities"><a href="#How-to-prevent-insecure-deserialization-vulnerabilities" class="headerlink" title="How to prevent insecure deserialization vulnerabilities"></a>How to prevent insecure deserialization vulnerabilities</h2><ol>
<li>éå¿…è¦ï¼Œä¸å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œååºåˆ—åŒ–ã€‚</li>
<li>å¦‚æœç¡®å®éœ€è¦ï¼Œä½¿ç”¨å¼ºè€Œæœ‰åŠ›çš„æªæ–½ä¿è¯æ•°æ®æ²¡è¢«ç¯¡æ”¹ã€‚æ¯”æ–¹è¯´ï¼Œä½¿ç”¨æ•°æ®ç­¾åã€‚è€Œä¸”è¦åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¹‹å‰è¿›è¡Œæ£€æŸ¥</li>
<li></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E7%9F%A5%E8%AF%86-cybersecurity/" rel="tag"><i class="fa fa-tag"></i> çŸ¥è¯†/cybersecurity</a>
              <a href="/tags/Web/" rel="tag"><i class="fa fa-tag"></i> Web</a>
              <a href="/tags/%E7%9F%A5%E8%AF%86-%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag"></i> çŸ¥è¯†/ç¬”è®°</a>
              <a href="/tags/%E8%8D%89%E7%A8%BF/" rel="tag"><i class="fa fa-tag"></i> è‰ç¨¿</a>
              <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> ååºåˆ—åŒ–</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/01/25/Notes/%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/" rel="prev" title="è¯»è®ºæ–‡">
      <i class="fa fa-chevron-left"></i> è¯»è®ºæ–‡
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/03/05/Notes/%E5%80%9F%E5%8A%A9race%20condition%E7%9A%84Web%20shell%E4%B8%8A%E4%BC%A0/" rel="next" title="å€ŸåŠ©race conditionçš„Web shellä¸Šä¼ ">
      å€ŸåŠ©race conditionçš„Web shellä¸Šä¼  <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Insecure-deserialization"><span class="nav-number">1.</span> <span class="nav-text">Insecure deserialization</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-serialization"><span class="nav-number">1.1.</span> <span class="nav-text">What is serialization?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Serialization-vs-deserialization"><span class="nav-number">1.1.1.</span> <span class="nav-text">Serialization vs deserialization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-insecure-deserialization"><span class="nav-number">1.2.</span> <span class="nav-text">What is insecure deserialization?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-do-insecure-deserialization-vulnerabilities-arise"><span class="nav-number">1.3.</span> <span class="nav-text">How do insecure deserialization vulnerabilities arise?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-the-impact-of-insecure-deserialization"><span class="nav-number">1.4.</span> <span class="nav-text">What is the impact of insecure deserialization?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exploiting-insecure-deserialization-vulnerabilities"><span class="nav-number">2.</span> <span class="nav-text">Exploiting insecure deserialization vulnerabilities</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-identify-insecure-deserialization"><span class="nav-number">2.1.</span> <span class="nav-text">How to identify insecure deserialization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP-serialization-format"><span class="nav-number">2.1.1.</span> <span class="nav-text">PHP serialization format</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-serialization-format"><span class="nav-number">2.1.2.</span> <span class="nav-text">Java serialization format</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Manipulating-serialized-objects"><span class="nav-number">2.2.</span> <span class="nav-text">Manipulating serialized objects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Modifying-object-attributes"><span class="nav-number">2.2.1.</span> <span class="nav-text">Modifying object attributes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LAB-Modifying-serialized-objects"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">LAB: Modifying serialized objects</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modifying-data-types"><span class="nav-number">2.2.2.</span> <span class="nav-text">Modifying data types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LAB-Modifying-serialized-data-types"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">LAB : Modifying serialized data types</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-application-functionality"><span class="nav-number">2.3.</span> <span class="nav-text">Using application functionality</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LAB-Using-application-functionality-to-exploit-insecure-deserialization"><span class="nav-number">2.3.0.1.</span> <span class="nav-text">LAB: Using application functionality to exploit insecure deserialization</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Magic-methods"><span class="nav-number">2.4.</span> <span class="nav-text">Magic methods</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Injecting-arbitrary-objects"><span class="nav-number">2.5.</span> <span class="nav-text">Injecting arbitrary objects</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Lab-Arbitrary-object-injection-in-PHP"><span class="nav-number">2.5.0.1.</span> <span class="nav-text">Lab: Arbitrary object injection in PHP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gadget-chains"><span class="nav-number">2.6.</span> <span class="nav-text">Gadget chains</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-with-pre-built-gadget-chains"><span class="nav-number">2.6.1.</span> <span class="nav-text">Working with pre-built gadget chains</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ysoserial"><span class="nav-number">2.6.1.1.</span> <span class="nav-text">ysoserial</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Note"><span class="nav-number">2.6.1.2.</span> <span class="nav-text">Note</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lab-Exploiting-Java-deserialization-with-Apache-Commons"><span class="nav-number">2.6.1.3.</span> <span class="nav-text">Lab: Exploiting JavaÂ deserializationÂ with Apache Commons</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PHP-Generic-Gadget-Chains"><span class="nav-number">2.6.1.4.</span> <span class="nav-text">PHP Generic Gadget Chains</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lab-Exploiting-PHP-deserialization-with-a-pre-built-gadget-chain"><span class="nav-number">2.6.1.5.</span> <span class="nav-text">Lab: Exploiting PHP deserialization with a pre-built gadget chain</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-prevent-insecure-deserialization-vulnerabilities"><span class="nav-number">2.7.</span> <span class="nav-text">How to prevent insecure deserialization vulnerabilities</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å¼ ä¸€å‰‘</p>
  <div class="site-description" itemprop="description">Just for fun :D</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/91Quin" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;91Quin" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:YijianCS@outlook.com" title="E-Mail â†’ mailto:YijianCS@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">é²ICPå¤‡2021011592å·-1 </a>
      <img src="https://raw.githubusercontent.com/91Quin/-for-hexo/main/img/202403011809721.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=37020202001534" rel="noopener" target="_blank">é²å…¬ç½‘å®‰å¤‡37020202001534å· </a>
  </div>

<div class="copyright">
  
  &copy; 2021 â€“ 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¼ ä¸€å‰‘</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'default',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
